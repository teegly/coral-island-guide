<div class="px-main-hz py-main-vt">
    <app-npc-filter class="z-30 relative"/>
    @if (filteredAndSortedNpcs(); as npcs) {

        <div class="grid npc-list-grid gap-x-4 gap-y-10 ">
            @for (npc of npcs; track npc) {
                <a [routerLink]="['..', npc.key]"
                   class="flex bg-[#F5F1E6] rounded-[30px] npc-list-entry group relative">
                    <div class="frame absolute inset-0 rounded-[30px] z-10 pointer-events-none"></div>
                    <div class="basis-2/5 aspect-square bg-[#F1E1CC] rounded-l-[30px] group-hover:bg-[#F2DBB7]">
                        <app-npc-head-portrait [npcKey]="npc.key" [portraitName]="npc.headerPortraitFileName"
                                               class="z-20 flex h-full relative rounded-l-[30px]"/>
                    </div>
                    <div class="basis-3/5 p-2 flex flex-col">
                        <div class="inline-flex gap-2 mt-3 items-center">
                            <span class="text-black font-semibold text-2xl">{{ npc.characterName }}</span>
                            @if (npc.isDateable) {
                                <app-ui-icon
                                        [uiIcon]="uiIcon.LOVE" class="!text-gifting !h-6 !w-6"
                                        matTooltip="{{npc.characterName}} is dateable"/>
                            }
                        </div>
                        @if (npc.birthday) {
                            <div class="text-lg flex gap-2 items-center">
                                <app-ui-icon [uiIcon]="uiIcon.BIRTHDAY" class="!w-5 !h-5"/>
                                {{ npc.birthday | ingameDate }}
                            </div>
                        }
                        <div [ngClass]="{'line-clamp-2': !npc.customHead, 'line-clamp-1': npc.customHead}">{{ npc.description }}</div>

                        @if (npc.canHaveRelationships) {
                            <div class="flex items-center gap-2 mt-auto pt-2 z-20 relative">
                                <button 
                                    (click)="decrementHeartLevel(npc.key, $event)"
                                    class="bg-[#F1E1CC] hover:bg-[#F2DBB7] rounded-full p-1 flex items-center justify-center"
                                    [disabled]="getHeartLevel(npc.key) === 0"
                                    matTooltip="Decrease heart level">
                                    <mat-icon class="!text-black !w-5 !h-5 !text-base">remove</mat-icon>
                                </button>
                                <div class="flex items-center gap-1">
                                    @for (heart of [1,2,3,4,5,6,7,8,9,10]; track heart) {
                                        <app-ui-icon 
                                            [uiIcon]="uiIcon.LOVE" 
                                            [class]="getHeartLevel(npc.key) >= heart ? '!text-gifting !h-4 !w-4' : '!text-gray-400 !h-4 !w-4 opacity-40'"
                                            [matTooltip]="heart + ' heart(s)'"/>
                                    }
                                </div>
                                <button 
                                    (click)="incrementHeartLevel(npc.key, $event)"
                                    class="bg-[#F1E1CC] hover:bg-[#F2DBB7] rounded-full p-1 flex items-center justify-center"
                                    [disabled]="getHeartLevel(npc.key) === 10"
                                    matTooltip="Increase heart level">
                                    <mat-icon class="!text-black !w-5 !h-5 !text-base">add</mat-icon>
                                </button>
                            </div>
                        }

                        @if (npc.customHead) {
                            <div clasS="mt-auto">unofficial head portrait</div>
                        }
                    </div>
                </a>
            }
        </div>

    } @else {
        <mat-spinner class="mx-auto text-white"/>
    }
</div>
